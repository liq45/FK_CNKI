<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FK_CNKI ä¸‹è½½åŠŸèƒ½æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .test-section h3 {
            color: #555;
            margin-top: 0;
        }
        
        .download-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .download-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #117a8b;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .instructions {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .instructions h4 {
            margin-top: 0;
            color: #1976d2;
        }
        
        .test-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ FK_CNKI ä¸‹è½½åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
        
        <div class="instructions">
            <h4>ğŸ“‹ æµ‹è¯•è¯´æ˜</h4>
            <p>è¿™ä¸ªé¡µé¢æ¨¡æ‹Ÿäº†CNKIçŸ¥ç½‘é¡µé¢ä¸­å¸¸è§çš„PDFä¸‹è½½æŒ‰é’®ï¼Œç”¨äºæµ‹è¯•FK_CNKIæ’ä»¶çš„æ™ºèƒ½ä¸‹è½½å…³è”åŠŸèƒ½ã€‚</p>
            <p><strong>æµ‹è¯•ç›®çš„ï¼š</strong>éªŒè¯æ’ä»¶èƒ½å¦è‡ªåŠ¨æ£€æµ‹é¡µé¢ä¸­çš„ä¸‹è½½æŒ‰é’®ï¼Œå¹¶åˆ›å»ºå…³è”çš„æ™ºèƒ½ä¸‹è½½æŒ‰é’®ã€‚</p>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª æ¨¡æ‹ŸCNKIä¸‹è½½æŒ‰é’®</h3>
            <p>ä»¥ä¸‹æ˜¯æ¨¡æ‹Ÿçš„CNKIé¡µé¢ä¸‹è½½æŒ‰é’®ï¼ŒFK_CNKIæ’ä»¶åº”è¯¥èƒ½å¤Ÿæ£€æµ‹åˆ°è¿™äº›æŒ‰é’®å¹¶åˆ›å»ºå…³è”ï¼š</p>
            
            <div class="download-buttons">
                <!-- æ¨¡æ‹ŸPDFä¸‹è½½æŒ‰é’® -->
                <a href="https://example.com/paper1.pdf" class="download-btn btn-primary" onclick="alert('PDFä¸‹è½½å·²è§¦å‘')">
                    PDFä¸‹è½½
                </a>
                
                <!-- æ¨¡æ‹Ÿå…¨æ–‡ä¸‹è½½æŒ‰é’® -->
                <button class="download-btn btn-success" onclick="alert('å…¨æ–‡ä¸‹è½½å·²è§¦å‘')">
                    å…¨æ–‡ä¸‹è½½
                </button>
                
                <!-- æ¨¡æ‹Ÿä¸‹è½½æŒ‰é’® -->
                <a href="https://example.com/paper2.pdf" class="download-btn btn-info" title="ä¸‹è½½PDFæ–‡ä»¶">
                    ä¸‹è½½
                </a>
                
                <!-- æ¨¡æ‹ŸCAJä¸‹è½½æŒ‰é’® -->
                <button class="download-btn btn-warning" onclick="downloadCAJ()">
                    CAJä¸‹è½½
                </button>
            </div>
            
            <div id="downloadStatus" class="status warning">
                â³ ç­‰å¾…FK_CNKIæ’ä»¶æ£€æµ‹ä¸‹è½½æŒ‰é’®...
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ” æ£€æµ‹ç»“æœ</h3>
            <div id="detectionResult" class="test-result">
                ç‚¹å‡»"å¼€å§‹æ£€æµ‹"æŒ‰é’®å¼€å§‹æµ‹è¯•...
            </div>
            <button onclick="startDetection()" class="download-btn btn-primary">å¼€å§‹æ£€æµ‹</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š åŠŸèƒ½éªŒè¯</h3>
            <div id="functionTest" class="test-result">
                åŠŸèƒ½æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
            <button onclick="testDownloadFunction()" class="download-btn btn-success">æµ‹è¯•ä¸‹è½½åŠŸèƒ½</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ’¡ ä½¿ç”¨æç¤º</h3>
            <ul>
                <li>ç¡®ä¿å·²å®‰è£…FK_CNKIæ’ä»¶</li>
                <li>åˆ·æ–°é¡µé¢è®©æ’ä»¶é‡æ–°æ£€æµ‹</li>
                <li>æŸ¥çœ‹é¡µé¢æ˜¯å¦å‡ºç°"æ™ºèƒ½ä¸‹è½½"æŒ‰é’®</li>
                <li>æµ‹è¯•æ™ºèƒ½ä¸‹è½½æŒ‰é’®çš„åŠŸèƒ½</li>
                <li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„æ—¥å¿—ä¿¡æ¯</li>
            </ul>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸCAJä¸‹è½½åŠŸèƒ½
        function downloadCAJ() {
            alert('CAJä¸‹è½½åŠŸèƒ½å·²è§¦å‘');
        }
        
        // å¼€å§‹æ£€æµ‹ä¸‹è½½æŒ‰é’®
        function startDetection() {
            const resultDiv = document.getElementById('detectionResult');
            resultDiv.textContent = 'æ­£åœ¨æ£€æµ‹é¡µé¢ä¸­çš„ä¸‹è½½æŒ‰é’®...\n\n';
            
            // æ£€æµ‹å„ç§ç±»å‹çš„ä¸‹è½½æŒ‰é’®
            const downloadButtons = [];
            
            // 1. æ£€æµ‹é“¾æ¥ç±»å‹çš„ä¸‹è½½æŒ‰é’®
            const downloadLinks = document.querySelectorAll('a[href*=".pdf"], a[href*="download"], a[href*="file"]');
            downloadLinks.forEach(link => {
                downloadButtons.push({
                    type: 'é“¾æ¥ä¸‹è½½',
                    text: link.textContent.trim(),
                    href: link.href,
                    onclick: link.getAttribute('onclick') || 'æ— '
                });
            });
            
            // 2. æ£€æµ‹æŒ‰é’®ç±»å‹çš„ä¸‹è½½æŒ‰é’®
            const downloadBtns = document.querySelectorAll('button[onclick*="download"], button[onclick*="PDF"]');
            downloadBtns.forEach(btn => {
                downloadButtons.push({
                    type: 'æŒ‰é’®ä¸‹è½½',
                    text: btn.textContent.trim(),
                    href: 'æ— ',
                    onclick: btn.getAttribute('onclick') || 'æ— '
                });
            });
            
            // 3. æ£€æµ‹æ–‡æœ¬å†…å®¹åŒ…å«ä¸‹è½½å…³é”®è¯çš„å…ƒç´ 
            const allElements = document.querySelectorAll('a, button');
            allElements.forEach(element => {
                const text = element.textContent || element.innerText || '';
                if (text.includes('ä¸‹è½½') || text.includes('PDF') || text.includes('Download')) {
                    const existing = downloadButtons.find(btn => btn.text === text.trim());
                    if (!existing) {
                        downloadButtons.push({
                            type: 'æ–‡æœ¬åŒ¹é…',
                            text: text.trim(),
                            href: element.href || 'æ— ',
                            onclick: element.getAttribute('onclick') || 'æ— '
                        });
                    }
                }
            });
            
            // æ˜¾ç¤ºæ£€æµ‹ç»“æœ
            if (downloadButtons.length > 0) {
                resultDiv.textContent += `âœ… æ£€æµ‹åˆ° ${downloadButtons.length} ä¸ªä¸‹è½½æŒ‰é’®ï¼š\n\n`;
                downloadButtons.forEach((btn, index) => {
                    resultDiv.textContent += `${index + 1}. ${btn.type}\n`;
                    resultDiv.textContent += `   æ–‡æœ¬: ${btn.text}\n`;
                    resultDiv.textContent += `   é“¾æ¥: ${btn.href}\n`;
                    resultDiv.textContent += `   onclick: ${btn.onclick}\n\n`;
                });
                
                // æ›´æ–°çŠ¶æ€
                document.getElementById('downloadStatus').className = 'status success';
                document.getElementById('downloadStatus').textContent = `âœ… æ£€æµ‹åˆ° ${downloadButtons.length} ä¸ªä¸‹è½½æŒ‰é’®`;
            } else {
                resultDiv.textContent += 'âŒ æœªæ£€æµ‹åˆ°ä»»ä½•ä¸‹è½½æŒ‰é’®';
                document.getElementById('downloadStatus').className = 'status error';
                document.getElementById('downloadStatus').textContent = 'âŒ æœªæ£€æµ‹åˆ°ä¸‹è½½æŒ‰é’®';
            }
        }
        
        // æµ‹è¯•ä¸‹è½½åŠŸèƒ½
        function testDownloadFunction() {
            const testDiv = document.getElementById('functionTest');
            testDiv.textContent = 'æ­£åœ¨æµ‹è¯•ä¸‹è½½åŠŸèƒ½...\n\n';
            
            // æ£€æŸ¥FK_CNKIæ’ä»¶çŠ¶æ€
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                testDiv.textContent += 'âœ… Chromeæ‰©å±•APIå¯ç”¨\n';
                
                // æ£€æŸ¥æ˜¯å¦å·²æ³¨å…¥FK_CNKI
                const toolbar = document.getElementById('cnki-helper-toolbar');
                if (toolbar) {
                    testDiv.textContent += 'âœ… FK_CNKIå·¥å…·æ å·²æ³¨å…¥\n';
                    
                    // æ£€æŸ¥æ™ºèƒ½ä¸‹è½½æŒ‰é’®
                    const enhancedBtn = document.querySelector('.cnki-download-btn.enhanced-download');
                    if (enhancedBtn) {
                        testDiv.textContent += 'âœ… æ™ºèƒ½ä¸‹è½½æŒ‰é’®å·²åˆ›å»º\n';
                        testDiv.textContent += `   æŒ‰é’®æ–‡æœ¬: ${enhancedBtn.textContent}\n`;
                        testDiv.textContent += `   æŒ‰é’®æ ‡é¢˜: ${enhancedBtn.title}\n`;
                    } else {
                        testDiv.textContent += 'âŒ æ™ºèƒ½ä¸‹è½½æŒ‰é’®æœªåˆ›å»º\n';
                    }
                } else {
                    testDiv.textContent += 'âŒ FK_CNKIå·¥å…·æ æœªæ³¨å…¥\n';
                }
            } else {
                testDiv.textContent += 'âŒ Chromeæ‰©å±•APIä¸å¯ç”¨\n';
            }
            
            testDiv.textContent += '\nğŸ’¡ æç¤ºï¼šå¦‚æœæ’ä»¶æ­£å¸¸å·¥ä½œï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ°ï¼š\n';
            testDiv.textContent += '1. é¡µé¢é¡¶éƒ¨æœ‰FK_CNKIå·¥å…·æ \n';
            testDiv.textContent += '2. ä¸‹è½½æŒ‰é’®æ—è¾¹æœ‰"æ™ºèƒ½ä¸‹è½½"æŒ‰é’®\n';
            testDiv.textContent += '3. ç‚¹å‡»æ™ºèƒ½ä¸‹è½½æŒ‰é’®èƒ½è§¦å‘å¯¹åº”çš„ä¸‹è½½åŠŸèƒ½\n';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æµ‹
        window.addEventListener('load', function() {
            setTimeout(() => {
                startDetection();
            }, 2000);
        });
    </script>
</body>
</html>
