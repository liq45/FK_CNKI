# FK_CNKI - 解除知网限制，去TM的！

一个专为CNKI知网用户设计的Chrome浏览器插件，**主要目的是解除CNKI页面对文字复制的限制**，让科研人员可以自由复制选中的文字到系统剪贴板，提升研究工作效率。

## 🎯 核心功能

### ✨ 解除复制限制（主要功能）
- **完全解除文字选择限制**：移除CNKI页面的`user-select: none`等CSS样式限制
- **重写复制事件**：覆盖禁止复制的事件监听器，允许正常的复制操作
- **启用右键菜单**：解除右键菜单限制，支持复制、粘贴等操作
- **支持拖拽选择**：允许拖拽选择文本内容
- **实时监控**：持续监控并移除新添加的限制，确保功能稳定
- **支持快捷键**：Ctrl+A全选、Ctrl+C复制等快捷键正常工作

### 📚 其他增强功能
- **一键下载**：快速下载论文和文献
- **搜索增强**：优化搜索体验，提供搜索历史和快速选项
- **快速访问**：便捷的CNKI页面导航和功能入口
- **下载管理**：记录和管理下载历史

## 🚀 技术特点

- **Manifest V3**：使用最新的Chrome扩展标准
- **响应式设计**：适配各种屏幕尺寸
- **深色模式**：自动适应系统主题
- **无障碍支持**：支持高对比度和减少动画模式
- **性能优化**：轻量级实现，不影响页面加载速度

## 📋 安装方法

### 方法1：开发者模式安装（推荐）
1. 下载并解压项目文件
2. 在Chrome中打开`chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择CNKI文件夹

### 方法2：打包安装
1. 在开发者模式下点击"打包扩展程序"
2. 选择CNKI文件夹
3. 生成.crx文件
4. 拖拽.crx文件到Chrome安装

详细安装步骤请参考 [INSTALL.md](INSTALL.md)

## 🔧 使用方法

### 基本使用
1. 安装插件后，访问任何CNKI页面
2. 页面顶部会显示"FK_CNKI"工具栏
3. 绿色"✅ 复制已启用"指示器表示复制功能已激活
4. 现在可以正常选择、复制文字内容了！

### 功能操作
- **快速下载**：点击工具栏的"下载"按钮
- **快速搜索**：点击"搜索"按钮打开搜索页面
- **设置**：点击"设置"按钮调整插件配置

### 键盘快捷键
- `Ctrl+D`：快速下载当前页面内容
- `Ctrl+F`：快速搜索

## 🧪 测试和调试

### 使用测试页面
项目提供了专门的测试页面来验证功能：

1. **复制功能测试页面** (`test-copy.html`)
   - 模拟CNKI的复制限制
   - 测试文字选择、复制粘贴功能
   - 验证右键菜单和键盘快捷键

2. **调试页面** (`debug.html`)
   - 检查扩展状态和权限
   - 测试存储和消息传递功能
   - 诊断常见问题和错误

### 调试步骤
1. 打开`debug.html`页面
2. 点击"检查扩展状态"按钮
3. 运行各项功能测试
4. 查看错误诊断结果

## 🏗️ 项目结构

```
CNKI/
├── manifest.json          # 扩展配置文件
├── popup.html            # 弹出窗口界面
├── popup.css             # 弹出窗口样式
├── popup.js              # 弹出窗口逻辑
├── background.js         # 后台服务脚本
├── content.js            # 内容脚本（核心功能）
├── content.css           # 内容样式
├── welcome.html          # 欢迎页面
├── test-copy.html        # 复制功能测试页面
├── debug.html            # 调试页面
├── icons/                # 图标文件
├── README.md             # 项目说明
└── INSTALL.md            # 安装指南
```

## ⚙️ 配置说明

### 权限说明
- `activeTab`：访问当前活动标签页
- `storage`：存储用户设置和下载历史
- `scripting`：动态注入脚本
- `downloads`：管理文件下载
- `notifications`：显示系统通知
- `tabs`：访问标签页信息
- `host_permissions`：访问CNKI域名

### 设置选项
- **自动下载**：启用/禁用自动下载功能
- **搜索增强**：启用/禁用搜索优化功能
- **快速访问**：启用/禁用快速导航功能

## 🛠️ 自定义开发

### 修改复制限制解除逻辑
主要逻辑在`content.js`的`removeCopyRestrictions()`方法中：

```javascript
// 核心功能：解除CNKI页面的复制限制
removeCopyRestrictions() {
    // 移除禁止选择文本的CSS样式
    this.removeSelectionRestrictions();
    
    // 重写禁止复制的事件监听器
    this.overrideCopyEvents();
    
    // 移除禁止右键菜单的限制
    this.removeContextMenuRestrictions();
    
    // 重写禁止拖拽的限制
    this.removeDragRestrictions();
    
    // 定期检查和清理新添加的限制
    this.startRestrictionMonitor();
}
```

### 添加新的限制解除方法
在`content.js`中添加新的方法来处理其他类型的限制。

## 🔍 故障排除

### 常见问题

#### 1. Service Worker注册失败
**症状**：扩展显示"Service worker registration failed. Status code: 15"
**解决方案**：
- 检查`background.js`文件是否有语法错误
- 确认所有Chrome API使用正确
- 使用`debug.html`页面进行诊断

#### 2. 复制功能不工作
**症状**：仍然无法选择或复制文字
**解决方案**：
- 检查插件是否正确安装
- 确认页面顶部显示"✅ 复制已启用"
- 使用`test-copy.html`进行功能测试
- 刷新页面重试

#### 3. 工具栏不显示
**症状**：访问CNKI页面时没有看到工具栏
**解决方案**：
- 确认扩展已启用
- 检查是否在正确的域名下（*.cnki.net 或 *.cnki.com）
- 使用`debug.html`检查扩展状态
- 查看浏览器控制台是否有错误

#### 4. 下载功能异常
**症状**：下载功能不工作或出错
**解决方案**：
- 检查下载路径设置
- 确认有足够的磁盘空间
- 检查`manifest.json`中的权限配置

### 调试方法
1. **使用调试页面**
   - 打开`debug.html`进行系统诊断
   - 运行各项功能测试
   - 查看详细的错误信息

2. **检查浏览器控制台**
   - 按F12打开开发者工具
   - 查看Console标签页的错误信息
   - 检查Network标签页的网络请求

3. **检查扩展权限**
   - 在扩展管理页面确认所有权限已授予
   - 检查`manifest.json`中的权限配置

4. **查看扩展日志**
   - 在扩展管理页面点击"检查视图"
   - 查看background和content script的日志

## 📝 更新日志

### v1.0.1
- 🔧 修复Service Worker注册失败问题
- 🔧 修复Chrome API使用错误
- 🔧 改进错误处理和异常捕获
- 🧪 添加调试页面和测试工具
- 📚 完善文档和故障排除指南

### v1.0.0
- ✨ 实现核心功能：解除CNKI页面文字复制限制
- 🎨 添加现代化UI界面
- 🔧 支持多种复制限制解除方法
- 📱 响应式设计，支持移动设备
- 🌙 深色模式支持
- ♿ 无障碍功能支持

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

### 贡献方式
1. Fork项目
2. 创建功能分支
3. 提交更改
4. 发起Pull Request

### 开发环境
- Chrome浏览器
- 文本编辑器
- 基本的HTML/CSS/JavaScript知识

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者和用户。

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

### 作者信息
- **GitHub**: [liq45](https://github.com/liq45)
- **Email**: liq45@qq.com

### 其他联系方式
- 提交GitHub Issue
- 发送邮件至项目维护者

---

**注意**：本插件仅用于学习和研究目的，请遵守相关网站的使用条款和版权规定。
